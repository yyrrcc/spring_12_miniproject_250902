<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycompany.mini.dao.BoardDao">

	<!-- 글쓰기 -->
	<insert id="boardWrite">
		INSERT INTO miniboard (bnum, memberid, title, content) VALUES (miniboard_seq.nextval, #{param1}, #{param2}, #{param3})
	</insert>
	
	<!-- 모든 글 개수 -->
	<select id="boardCount" resultType="int">
		SELECT count(*) FROM miniboard
	</select>	
	
	<!-- 모든 글 목록 + 페이징 -->
	<resultMap type="com.mycompany.mini.dto.BoardDto" id="boardWithMember">
		<id property="bnum" column="bnum"/>
		<result property="memberId" column="memberId"/>
		<result property="title" column="title"/>
		<result property="content" column="content"/>
		<result property="hit" column="hit"/>
		<result property="regDate" column="regDate"/>
		<result property="rnum" column="rnum"/> <!-- 이걸 까먹으면 안 된다 -->
			<association property="memberDto" javaType="com.mycompany.mini.dto.MemberDto">
				<id property="memberId" column="memberId"/>
				<result property="password" column="password"/>
				<result property="name" column="name"/>
				<result property="phone" column="phone"/>
				<result property="email" column="email"/>
				<result property="regDate" column="regDate"/>
			</association>
	</resultMap>
	<select id="boardList" resultMap="boardWithMember">
		<![CDATA[
		SELECT * FROM (
			SELECT ROWNUM AS rnum, r.* FROM (
				SELECT b.bnum, b.title, b.content, b.memberid, m.name, b.hit, b.regdate FROM miniboard b
				INNER JOIN minimember m ON b.memberid = m.memberid
				ORDER BY b.bnum DESC) r
			WHERE ROWNUM <= #{param2})
		WHERE rnum >= #{param1}
		]]>
	</select>
	
	<!-- 글 세부사항 -->
	<select id="boardDetail" resultType="com.mycompany.mini.dto.BoardDto">
		SELECT * FROM miniboard WHERE bnum = #{param1}
	</select>
	
	<!-- 조회수 -->
	<update id="updateHit">
		UPDATE miniboard SET hit = hit + 1 WHERE bnum = #{param1}
	</update>
	
	<!-- 글 삭제하기 -->
	<delete id="boardDelete">
		DELETE FROM miniboard WHERE bnum = #{param1}
	</delete>	

</mapper>
